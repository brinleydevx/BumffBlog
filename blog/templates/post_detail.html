{% extends "base.html" %}
{% block content %}
<article>
    <h2>
        {{ post.title }}
    </h2>
    <small>
        {{ post.date_created.strftime("%Y-%m-%d") }}
    </small>
    <p>{{ post.content }}</p>
    {% if current_user.is_authenticated %}
        <form method="POST">
            {{ form.hidden_tag() }}
            {{ form.content.label }}
            {{ form.content(rows=3) }}
            {{ form.submit() }}
        </form>
    {% else %}
        <p><a href="{{ url_for('main.login') }}">Login</a></p>
    {% endif %}

    <h3>Comments ({{ post.comments|length }})</h3>

    {% for comment in post.comments %}
        <div class="comment">
            <strong>{{ comment.author.username }}</strong>
            <small>{{ comment.date_created.strftime("%Y-%m-%d %H:%M") }}</small>

            <p>{{ comment.content }}</p>

            {% if comment.author == current_user %}
                <a href="{{ url_for('main.delete_comment', id=comment.id) }}"
                   onclick="return confirm('Delete comment?')">
                   Delete
                </a>
            {% endif %}
        </div>
        <hr>
    {% else %}
        <p>No comments yet.</p>
    {% endfor %}


    <p>
        By
        <a href="{{ url_for('main.user_profile', username=post.author.username) }}">
            {{ post.author.username }}
        </a>
    </p>

    {% if current_user.is_authenticated and post.author == current_user %}
        <a href="{{ url_for('main.edit_post', id=post.id) }}">
            Edit Post
        </a>

    <form method="POST"
        action="{{ url_for('main.delete_post', post_id=post.id) }}"
        style="display:inline;">
        <button type="submit"
            class="btn btn-danger"
            onclick="return confirm('Are you sure you want to delete this post?');">
            Delete
        </button>
  </form>
    {% endif %}

</article>
    <hr>
    <a href="/home">Back to Posts</a>
{% endblock %}